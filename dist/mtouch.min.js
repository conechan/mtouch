!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("MTouch",e):t.MTouch=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,n){if(!(this instanceof e))return new e(t,n);var o=void 0;if("string"==typeof t?(o={},o.receiver=t,n&&(o.operator=n)):"object"===(void 0===t?"undefined":s(t))&&(o=t),this.ops={receiver:null,operator:null,touchstart:function(){},touchmove:function(){},touchend:function(){},drag:function(){},dragstart:function(){},dragend:function(){},pinch:function(){},pinchstart:function(){},pinchend:function(){},rotate:function(){},rotatestart:function(){},rotatend:function(){},singlePinch:{start:function(){},pinch:function(){},end:function(){},buttonId:null},singleRotate:{start:function(){},rotate:function(){},end:function(){},buttonId:null}},this.use={drag:!!o.drag||!!o.dragstart||!!o.dragend,pinch:!!o.pinch||!!o.pinchstart||!!o.pinchend,rotate:!!o.rotate||!!o.rotatestart||!!o.rotateend,singlePinch:!!o.singlePinch&&!!o.singlePinch.buttonId,singleRotate:!!o.singleRotate&&!!o.singleRotate.buttonId},this.ops=i.extend(this.ops,o),!this.ops.receiver||"string"!=typeof this.ops.receiver)return void console.error("receiver error,there must be a receiver-selector");if(this.receiver=document.querySelector(this.ops.receiver),this.ops.operator){if("string"!=typeof this.ops.operator)return void console.error("operator error, the operator param must be a selector");this.operator=document.querySelector(this.ops.operator)}else this.operator=this.receiver;this.fingers=0,this.draging=this.pinching=this.rotating=this.singleRotating=this.singlePinching=!1,this.startScale=1,this.startPoint={},this.secondPoint={},this.pinchStartLength=null,this.singlePinchStartLength=null,this.vector1={},this.singleBasePoint={},this.driveBus(),this.bind()}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i={getLength:function(t){return"object"!==(void 0===t?"undefined":n(t))?void console.error("getLength error!"):Math.sqrt(t.x*t.x+t.y*t.y)},getAngle:function(t,e){if("object"!==(void 0===t?"undefined":n(t))||"object"!==(void 0===e?"undefined":n(e)))return void console.error("getAngle error!");var i=t.x*e.y-e.x*t.y>0?1:-1,o=this.getLength(t),r=this.getLength(e),s=o*r,h=void 0,c=void 0;return 0===s?0:(h=t.x*e.x+t.y*e.y,c=h/s,c>1&&(c=1),c<-1&&(c=-1),Math.acos(c)*i*180/Math.PI)},getBasePoint:function(t){if(!t)return void console.error("getBasePoint error!");var e=this.getOffset(t),n=e.left+t.getBoundingClientRect().width/2,i=e.top+t.getBoundingClientRect().width/2;return{x:Math.round(n),y:Math.round(i)}},setPos:function(t,e){var n=JSON.stringify(e),i="translate3d("+e.x+"px,"+e.y+"px,0px) scale("+e.scale+") rotate("+e.rotate+"deg)";t="string"==typeof t?document.querySelector(t):t,t.style.transform=i,t.setAttribute("data-mtouch-status",n)},getPos:function(t){var e=void 0,n=window.getComputedStyle(t,null).transform;return e=window.getComputedStyle&&"none"!==n?this.matrixTo(n):{x:0,y:0,scale:1,rotate:0},JSON.parse(t.getAttribute("data-mtouch-status"))||e},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&("object"==n(e[i])?("object"!==n(t[i])&&(t[i]={}),this.extend(t[i],e[i])):t[i]=e[i]);return t},getVector:function(t,e){return"object"!==(void 0===t?"undefined":n(t))||"object"!==(void 0===e?"undefined":n(e))?void console.error("getvector error!"):{x:Math.round(t.x-e.x),y:Math.round(t.y-e.y)}},getPoint:function(t,e){return t&&t.touches[e]?{x:Math.round(t.touches[e].pageX),y:Math.round(t.touches[e].pageY)}:void console.error("getPoint error!")},getOffset:function(t){t="string"==typeof t?document.querySelector(t):t;var e=t.getBoundingClientRect();return{left:e.left+document.body.scrollLeft,top:e.top+document.body.scrollTop,width:t.offsetWidth,height:t.offsetHeight}},matrixTo:function(t){var e=t.replace("matrix(","").replace(")","").split(","),n=e[0],i=e[1],o=i/n,r=180*Math.atan(o)/Math.PI,s=n/Math.cos(Math.PI/180*r);return{x:parseInt(e[4]),y:parseInt(e[5]),scale:s,rotate:r}},getUseName:function(t){var e=t.replace("start",""),n=-1!==e.indexOf("rotate")?"nd":"end";return e=e.replace(n,"")}},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function e(n){t(this,e),this.handlers=[],this.el=n}return o(e,[{key:"add",value:function(t){return this.handlers.push(t),this}},{key:"del",value:function(t){var e=this;return t?this.handlers.forEach(function(n,i){n===t&&e.handlers.splice(i,1)}):this.handlers=[],this}},{key:"fire",value:function(){var t=this,e=arguments;if(this.handlers&&0!==!this.handlers.length)return this.handlers.forEach(function(n){"function"==typeof n&&n.apply(t.el,e)}),this}}]),e}(),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=["touchstart","touchmove","touchend","drag","dragstart","dragend","pinch","pinchstart","pinchend","rotate","rotatestart","rotatend"],c=["touchstart","touchmove","touchend","touchcancel"];return e.prototype.driveBus=function(){var t=this;h.forEach(function(e){t[e]=new r(t.receiver).add(t.ops[e]||function(){})}),this.singlePinchstart=new r(this.receiver).add(this.ops.singlePinch.start||function(){}),this.singlePinch=new r(this.receiver).add(this.ops.singlePinch.pinch||function(){}),this.singlePinchend=new r(this.receiver).add(this.ops.singlePinch.end||function(){}),this.singleRotatestart=new r(this.receiver).add(this.ops.singleRotate.start||function(){}),this.singleRotate=new r(this.receiver).add(this.ops.singleRotate.rotate||function(){}),this.singleRotatend=new r(this.receiver).add(this.ops.singleRotate.end||function(){})},e.prototype.bind=function(){var t=this;c.forEach(function(e){var n="touchcancel"==e?"end":e.replace("touch","");t[n+"bind"]=t[n].bind(t),t.receiver.addEventListener(e,t[n+"bind"],!1)})},e.prototype.destroy=function(){var t=this;c.forEach(function(e){var n="touchcancel"==e?"end":e.replace("touch","");t.receiver.removeEventListener(e,t[n+"bind"],!1)})},e.prototype.start=function(t){if(t.touches&&"touchstart"===t.type){if(this.fingers=t.touches.length,this.startPoint=i.getPoint(t,0),this.singleBasePoint=i.getBasePoint(this.operator),this.fingers>1)this.secondPoint=i.getPoint(t,1),this.vector1=i.getVector(this.secondPoint,this.startPoint),this.pinchStartLength=i.getLength(this.vector1);else if(this.use.singlePinch){var e=i.getVector(this.startPoint,this.singleBasePoint);this.singlePinchStartLength=i.getLength(e)}this.touchstart.fire({origin:t,eventType:"touchstart"})}},e.prototype.move=function(t){if(t.touches&&"touchmove"===t.type){var e=i.getPoint(t,0),n=t.touches.length,o=void 0,r=void 0,s=void 0,h=void 0,c=void 0;if(n<this.fingers)return this.startPoint=e,void(this.fingers=n);if(!(n>1)||this.secondPoint&&this.vector1&&this.pinchStartLength||(this.secondPoint=i.getPoint(t,1),this.vector1=i.getVector(this.secondPoint,this.startPoint),this.pinchStartLength=i.getLength(this.vector1)),n>1){var a=i.getPoint(t,1),u=i.getVector(a,e);this.use.pinch&&(h=i.getLength(u),this.eventFire("pinch",{delta:{scale:h/this.pinchStartLength},origin:t}),this.pinchStartLength=h),this.use.rotate&&(this.eventFire("rotate",{delta:{rotate:i.getAngle(this.vector1,u)},origin:t}),this.vector1=u)}else this.use.singlePinch&&t.target.id==this.ops.singlePinch.buttonId&&(s=i.getVector(e,this.singleBasePoint),c=i.getLength(s),this.eventFire("singlePinch",{delta:{scale:c/this.singlePinchStartLength},origin:t}),this.singlePinchStartLength=c),this.use.singleRotate&&t.target.id==this.ops.singleRotate.buttonId&&(o=i.getVector(this.startPoint,this.singleBasePoint),r=i.getVector(e,this.singleBasePoint),this.eventFire("singleRotate",{delta:{rotate:i.getAngle(o,r)},origin:t}));this.use.drag&&t.target.id!==this.ops.singlePinch.buttonId&&t.target.id!==this.ops.singleRotate.buttonId&&this.eventFire("drag",{delta:{deltaX:e.x-this.startPoint.x,deltaY:e.y-this.startPoint.y},origin:t}),this.startPoint=e,this.touchmove.fire({eventType:"touchmove",origin:t}),t.preventDefault()}},e.prototype.end=function(t){var e=this;(t.touches||"touchend"===t.type||"touchcancel"===t.type)&&(["pinch","drag","rotate","singleRotate","singlePinch"].forEach(function(n){e.eventEnd(n,{origin:t})}),this.touchend.fire({eventType:"touchend",origin:t}))},e.prototype.eventFire=function(t,e){var n=t+"ing",i=t+"start";this[n]?(e.eventType=t,this[t].fire(e)):(e.eventType=i,this[i].fire(e),this[n]=!0)},e.prototype.eventEnd=function(t,e){var n=t+"ing",i=void 0;i="rotate"==t||"singleRotate"==t?t+"nd":t+"end",this[n]&&(e.eventType=i,this[i].fire(e),this[n]=!1)},e.prototype.switchOperator=function(t){this.operator=t},e.prototype.on=function(t,e){this.use[i.getUseName(t)]=!0,this[t].add(e)},e.prototype.off=function(t,e){this[t].del(e)},e});
//# sourceMappingURL=mtouch.min.js.map
