{"version":3,"file":"mtouch.es.js","sources":["../src/utils.js","../src/handlerBus.js","../src/index.js"],"sourcesContent":["export default {\n    getLength(v1) {\n        if (typeof v1 !== 'object') {\n            console.error('getLength error!');\n            return;\n        }\n        return Math.sqrt(v1.x * v1.x + v1.y * v1.y);\n    },\n    getAngle(v1, v2) {\n        if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n            console.error('getAngle error!');\n            return;\n        }\n        let direction = v1.x * v2.y - v2.x * v1.y > 0 ? 1: -1,\n            len1 = this.getLength(v1),\n            len2 = this.getLength(v2),\n            mr = len1 * len2,\n            dot,r;\n        if (mr === 0)return 0;\n        dot = v1.x * v2.x + v1.y * v2.y;\n        r = dot / mr;\n        if (r > 1)r = 1;\n        if (r < -1)r = -1;\n        return Math.acos(r) * direction * 180 / Math.PI;\n    },\n    getBasePoint(el) {\n        if (!el) {\n            console.error('getBasePoint error!');\n            return;\n        }\n        let offset = this.getOffset(el);\n        let x = offset.left + el.getBoundingClientRect().width / 2,\n            y = offset.top + el.getBoundingClientRect().width / 2;\n        return {x: Math.round(x), y: Math.round(y)};\n    },\n    setPos(el, transform) {\n        let str = JSON.stringify(transform);\n        let value = `translate3d(${transform.x}px,${transform.y}px,0px) scale(${transform.scale}) rotate(${transform.rotate}deg)`;\n        el = typeof el == 'string'? document.querySelector(el): el;\n        el.style.transform = value;\n        el.setAttribute('data-mtouch-status', str);\n    },\n    getPos(el) {\n        let defaulTrans;\n        let cssTrans = window.getComputedStyle(el,null).transform;\n        if(window.getComputedStyle && cssTrans !== 'none'){\n            defaulTrans = this.matrixTo(cssTrans);\n        }else{\n            defaulTrans = {\n                x: 0,\n                y: 0,\n                scale: 1,\n                rotate: 0,\n            };\n        }\n        return JSON.parse(el.getAttribute('data-mtouch-status')) || defaulTrans;\n    },\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if(typeof obj2[k] == 'object'){\n                    if(typeof obj1[k] !== 'object'){\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k],obj2[k]);\n                }else{\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    getVector(p1, p2) {\n        if (typeof p1 !== 'object' || typeof p2 !== 'object' ) {\n            console.error('getvector error!');\n            return;\n        }\n        let x = Math.round(p1.x - p2.x),\n            y = Math.round(p1.y - p2.y);\n        return { x, y };\n    },\n    getPoint(ev, index) {\n        if (!ev || !ev.touches[index]) {\n            console.error('getPoint error!');\n            return;\n        }\n        return {\n            x: Math.round(ev.touches[index].pageX),\n            y: Math.round(ev.touches[index].pageY),\n        };\n    },\n    getOffset(el){\n        el = typeof el == 'string'? document.querySelector(el): el;\n        let rect = el.getBoundingClientRect();\n        let offset = {\n            left:rect.left + document.body.scrollLeft,\n            top:rect.top + document.body.scrollTop,\n            width:el.offsetWidth,\n            height:el.offsetHeight,\n        };\n        return offset;\n    },\n    matrixTo(matrix){\n        let arr = (matrix.replace('matrix(','').replace(')','')).split(',');\n        let cos = arr[0],\n            sin = arr[1],\n            tan = sin / cos,\n            rotate = Math.atan( tan ) * 180 / Math.PI,\n            scale = cos / ( Math.cos( Math.PI / 180 * rotate )),\n            trans;\n        trans = {\n            x:parseInt(arr[4]),\n            y:parseInt(arr[5]),\n            scale,\n            rotate,\n        };\n        return trans;\n    },\n};\n","export default class HandlerBus{\n    constructor(el) {\n        this.handlers = [];\n        this.el = el;\n    };\n    add(handler){\n        this.handlers.push(handler);\n        return this;\n    };\n    del(handler){\n        if(!handler){\n            this.handlers = [];\n        }else{\n            this.handlers.forEach((value,index)=>{\n                if(value === handler){\n                    this.handlers.splice(index,1);\n                }\n            });\n        }\n        return this;\n    };\n    fire(){\n        if(!this.handlers || !this.handlers.length === 0)return;\n        this.handlers.forEach(handler=>{\n            if(typeof handler === 'function') handler.apply(this.el, arguments);\n        })\n        return this;\n    };\n}\n","import _ from './utils';\nimport HandlerBus from './handlerBus';\n\nconst EVENT = [\n    'touchstart',\n    'touchmove',\n    'touchend',\n    'drag',\n    'dragstart',\n    'dragend',\n    'pinch',\n    'pinchstart',\n    'pinchend',\n    'rotate',\n    'rotatestart',\n    'rotatend',\n];\nexport default class MTouch {\n    constructor(options) {\n        this.ops = {\n            // config:\n            receiver: null,\n            operator: null,\n\n            // event\n            touchstart() {},\n            touchmove() {},\n            touchend() {},\n\n            drag() {},\n            dragstart() {},\n            dragend() {},\n\n            pinch() {},\n            pinchstart() {},\n            pinchend() {},\n\n            rotate() {},\n            rotatestart() {},\n            rotatend() {},\n\n            singlePinch:{\n                start(){},\n                pinch(){},\n                end(){},\n                buttonId:null,\n            },\n\n            singleRotate:{\n                start(){},\n                rotate(){},\n                end(){},\n                buttonId:null,\n            },\n        };\n\n        // 开关；\n        this.use = {\n            drag: !!options.drag || !!options.dragstart || !!options.dragend,\n            pinch: !!options.pinch || !!options.pinchstart || !!options.pinchend,\n            rotate: !!options.rotate || !!options.rotatestart || !!options.rotateend,\n            singlePinch: !!options.singlePinch && !!options.singlePinch.buttonId,\n            singleRotate: !!options.singleRotate && !!options.singleRotate.buttonId,\n        };\n\n        this.ops = _.extend(this.ops, options);\n\n        // receiver test;\n        if(!this.ops.receiver || typeof this.ops.receiver !== 'string'){\n            console.error('receiver error,there must be a receiver-selector');\n            return;\n        }\n        // 事件接收器；\n        this.receiver = document.querySelector(this.ops.receiver);\n\n        // 事件操纵器；\n        if (this.ops.operator) {\n            if(typeof this.ops.operator !== 'string'){\n                console.error('operator error, the operator param must be a selector');\n                return;\n            }\n            this.operator = document.querySelector(this.ops.operator);\n        } else {\n            this.operator = this.receiver;\n        }\n\n        // touch状态；\n        this.fingers = 0;\n        // 初始状态;\n        this.draging = this.pinching = this.rotating = this.singleRotating = this.singlePinching = false;\n\n        this.startScale = 1;\n        this.startPoint = {};\n        this.secondPoint = {};\n        this.pinchStartLength = null;\n        this.singlePinchStartLength = null;\n        this.vector1 = {};\n        this.singleBasePoint = {};\n        // eventbus\n        this.driveBus();\n        this.bind();\n    }\n    driveBus() {\n        EVENT.forEach(eventName => {\n            this[eventName] = new HandlerBus(this.receiver).add(this.ops[eventName] || function(){});\n        });\n        this.singlePinchstart = new HandlerBus(this.receiver).add(this.ops.singlePinch.start || function(){});\n        this.singlePinch = new HandlerBus(this.receiver).add(this.ops.singlePinch.pinch || function(){});\n        this.singlePinchend = new HandlerBus(this.receiver).add(this.ops.singlePinch.end || function(){});\n        this.singleRotatestart = new HandlerBus(this.receiver).add(this.ops.singleRotate.start || function(){});\n        this.singleRotate = new HandlerBus(this.receiver).add(this.ops.singleRotate.rotate || function(){});\n        this.singleRotatend = new HandlerBus(this.receiver).add(this.ops.singleRotate.end || function(){});\n    }\n    bind() {\n        ['touchstart', 'touchmove', 'touchend', 'touchcancel'].forEach(evName => {\n            let fn = evName == 'touchcancel'? 'end': evName.replace('touch', '');\n            this.receiver.addEventListener(evName, this[fn].bind(this), false);\n        });\n    }\n    start(ev) {\n        if (!ev.touches || ev.type !== 'touchstart')return;\n\n        this.fingers = ev.touches.length;\n        this.startPoint = _.getPoint(ev, 0);\n        this.singleBasePoint = _.getBasePoint(this.operator);\n\n        if (this.fingers > 1) {\n            this.secondPoint = _.getPoint(ev, 1);\n            this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n            this.pinchStartLength = _.getLength(this.vector1);\n        } else if (this.use.singlePinch) {\n            let pinchV1 = _.getVector(this.startPoint, this.singleBasePoint);\n            this.singlePinchStartLength = _.getLength(pinchV1);\n        }\n\n        this.touchstart.fire({\n            origin : ev,\n            eventType:'touchstart',\n        });\n    }\n    move(ev) {\n        if (!ev.touches || ev.type !== 'touchmove')return;\n        let curPoint = _.getPoint(ev, 0);\n        let curFingers = ev.touches.length;\n        let rotateV1,\n            rotateV2,\n            pinchV2,\n            pinchLength,\n            singlePinchLength;\n\n        // 当从原先的两指到一指的时候，可能会出现基础手指的变化，导致跳动；\n        // 因此需屏蔽掉一次错误的touchmove事件，待重新设置基础指后，再继续进行；\n        if (curFingers < this.fingers) {\n            this.startPoint = curPoint;\n            this.fingers = curFingers;\n            return;\n        }\n\n        // 两指先后触摸时，只会触发第一指一次touchstart，第二指不会再次触发touchstart；\n        // 因此会出现没有记录第二指状态，需要在touchmove中重新获取参数；\n        if (curFingers > 1 && (!this.secondPoint || !this.vector1 || !this.pinchStartLength)) {\n            this.secondPoint = _.getPoint(ev, 1);\n            this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n            this.pinchStartLength = _.getLength(this.vector1);\n        }\n\n        // 双指时，需触发pinch和rotate事件；\n        if (curFingers > 1) {\n            let curSecPoint = _.getPoint(ev, 1);\n            let vector2 = _.getVector(curSecPoint, curPoint);\n            // pinch\n            if (this.use.pinch) {\n                pinchLength = _.getLength(vector2);\n                this.eventFire('pinch', {\n                    delta:{\n                        scale: pinchLength / this.pinchStartLength,\n                    },\n                    origin:ev,\n                });\n                this.pinchStartLength = pinchLength;\n            }\n            // rotate\n            if (this.use.rotate) {\n                this.eventFire('rotate', {\n                    delta:{\n                        rotate: _.getAngle(this.vector1, vector2),\n                    },\n                    origin:ev,\n                });\n                this.vector1 = vector2;\n            }\n        } else {\n            // singlePinch;\n            if (this.use.singlePinch && ev.target.id == this.ops.singlePinch.buttonId) {\n                pinchV2 = _.getVector(curPoint, this.singleBasePoint);\n                singlePinchLength = _.getLength(pinchV2);\n                this.eventFire('singlePinch', {\n                    delta:{\n                        scale: singlePinchLength / this.singlePinchStartLength,\n                    },\n                    origin:ev,\n                });\n                this.singlePinchStartLength = singlePinchLength;\n            }\n            // singleRotate;\n            if (this.use.singleRotate && ev.target.id == this.ops.singleRotate.buttonId) {\n                rotateV1 = _.getVector(this.startPoint, this.singleBasePoint);\n                rotateV2 = _.getVector(curPoint, this.singleBasePoint);\n                this.eventFire('singleRotate', {\n                    delta:{\n                        rotate: _.getAngle(rotateV1, rotateV2),\n                    },\n                    origin:ev,\n                });\n            }\n        }\n        if (this.use.drag) {\n            if (ev.target.id !== this.ops.singlePinch.buttonId && ev.target.id !== this.ops.singleRotate.buttonId) {\n                this.eventFire('drag', {\n                    delta:{\n                        deltaX: curPoint.x - this.startPoint.x,\n                        deltaY: curPoint.y - this.startPoint.y,\n                    },\n                    origin:ev,\n                });\n            }\n        }\n        this.startPoint = curPoint;\n        this.touchmove.fire({\n            eventType:'touchmove',\n            origin:ev,\n        });\n        ev.preventDefault();\n    }\n    end(ev) {\n        if (!ev.touches && ev.type !== 'touchend' && ev.type !== 'touchcancel')\n            return;\n\n        ['pinch', 'drag', 'rotate', 'singleRotate', 'singlePinch'].forEach(evName => {\n            this.eventEnd(evName, {\n                origin:ev,\n            });\n        });\n        this.touchend.fire({\n            eventType:'touchend',\n            origin:ev,\n        });\n    }\n    eventFire(evName, ev) {\n        let ing = `${evName}ing`;\n        let start = `${evName}start`;\n        if (!this[ing]) {\n            ev.eventType = start;\n            this[start].fire(ev);\n            this[ing] = true;\n        } else {\n            ev.eventType = evName;\n            this[evName].fire(ev);\n        }\n    }\n    eventEnd(evName, ev) {\n        let ing = `${evName}ing`;\n        let end;\n        if (evName == 'rotate' || evName == 'singleRotate') {\n            end = `${evName}nd`;\n        } else {\n            end = `${evName}end`;\n        }\n        if (this[ing]) {\n            ev.eventType = end;\n            this[end].fire(ev);\n            this[ing] = false;\n        }\n    }\n    switchOperator(el) {\n        this.operator = el;\n    }\n    on(evName, handler) {\n        this[evName] && this[evName].add(handler);\n    }\n    off(evName, handler) {\n        this[evName] && this[evName].del(handler);\n    }\n}\n"],"names":["v1","error","Math","sqrt","x","y","v2","direction","len1","getLength","len2","mr","dot","r","acos","PI","el","offset","getOffset","left","getBoundingClientRect","width","top","round","transform","str","JSON","stringify","value","scale","rotate","document","querySelector","style","setAttribute","defaulTrans","cssTrans","window","getComputedStyle","matrixTo","parse","getAttribute","obj1","obj2","k","hasOwnProperty","extend","p1","p2","ev","index","touches","pageX","pageY","rect","body","scrollLeft","scrollTop","offsetWidth","offsetHeight","matrix","arr","replace","split","cos","sin","tan","atan","trans","parseInt","HandlerBus","handlers","handler","push","forEach","splice","length","apply","EVENT","MTouch","options","ops","use","drag","dragstart","dragend","pinch","pinchstart","pinchend","rotatestart","rotateend","singlePinch","buttonId","singleRotate","_","receiver","operator","fingers","draging","pinching","rotating","singleRotating","singlePinching","startScale","startPoint","secondPoint","pinchStartLength","singlePinchStartLength","vector1","singleBasePoint","driveBus","bind","eventName","add","singlePinchstart","start","singlePinchend","end","singleRotatestart","singleRotatend","fn","evName","addEventListener","type","getPoint","getBasePoint","getVector","pinchV1","touchstart","fire","curPoint","curFingers","rotateV1","rotateV2","pinchV2","pinchLength","singlePinchLength","curSecPoint","vector2","eventFire","getAngle","target","id","touchmove","preventDefault","eventEnd","touchend","ing","eventType","del"],"mappings":"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"}